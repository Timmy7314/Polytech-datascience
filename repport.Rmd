---
title: "Wine Quality"
author: "Alexandre SALMON, Thomas FRION"
date: "13/01/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("ggplot2")
library("reshape2")
library("GGally")
library("rpart")

```

# 1 Objectif de l'étude

Notre étude va porter sur la qualité des vins portugais, de la région Vinho Verde. Nos objectifs via cette étude sont : 

* Déterminer un modèle de prédiction de la qualité d'un vin rouge et d'un vin blanc. Ainsi, connaitre le critère physionomique le plus important dans la détermination de la qualité pour chaque type de vin.
* Comparer les deux modèles (blanc et rouge) pour savoir si ce qui vait un bon vin blanc, fait un bon vin rouge

Les conclusions de cette étude pourront permettre aux vignerons d'améliorer la qualité de leurs vins.

# 2 Analyse descriptive

Pour cette étude nous disposons de deux jeux de données : un pour le vin rouge et 1 pour le vin blanc. Nous avons obtenu ces données sur la page [UCI: Wine Quality Data Set](https://archive.ics.uci.edu/ml/datasets/Wine+Quality) 

Pour les deux jeux de données nous avons douze variables: onze variables d'entrée qui correspondent aux critères physionomiques du vin et une variable de sortie qui correspond à la qualité du vin en 0 et 10.
Les onze critères physionomiques sont les suivantes : 

1. Acidité fixe (ou acidité naturelle du raisin)
2. Acidité volatile (teneur d'acides gras)
3. Acide citrique (teneur d'acide citrique)
4. Sucre résiduel (sucres encore présents après la fermentation)
5. Chlorures (teneur des différents chlorures)
6. Dioxyde de soufre ($SO_2$) libre (teneur du principe actif du $SO_2$)
7. Total du dioxyde de soufre ($SO_2$) (teneur de toutes les formes du $SO_2$)
8. Densité
9. pH
10. Sulfates (teneur du fongicide)
11. Alcool

La variable de sortie correspond à la médianne des notes données par des experts (au minimun trois notes). Si la variable vaut 0 sela signifie que le vin est de très mauvaise qualité. Si la variable vaut 10 alors le vin est de bonne qualité.

Nous avons 1599 vins rouges et 4898 vins blancs.

Nous allons maintenant décrire les liens entre les différentes variables.

Nous pouvons déjà annoncer un lien entre deux variables : $SO_2$ libre et $SO_2$ total. Ce lien est le suivant : plus la teneur en $SO_2$ libre augmente et la teneur totale en $SO_2$ augmente.

Afin de connaître d'autres liens entre les variables d'entrée, nous avons décidé de calculer la corrélation entre les différentes variables sur trois jeux de données différents.
Le premier calcul de corrélation a été fait sur un ensemble de données composé de 50% de vins rouges et 50% de vins blancs. Nous avons créer cette ensemble de données afin de voir de façon globale les liens entre les différentes variables. Voici les résultats de ce premier calcul : 

```{r}
RWine <- read.csv("./data/winequality-red.csv", sep = ";"); 
WWine <- read.csv("./data/winequality-white.csv", sep = ";");

WWine['type']='White'
RWine['type']='Red'
AWine<-rbind(RWine, WWine)
AWine5050 <- rbind(WWine[sample(nrow(WWine), 1000), ], RWine[sample(nrow(RWine), 1000), ])
ggcorr(AWine5050[, -1], geom = "blank", label = TRUE, hjust = 0.75) +
  geom_point(size = 10, aes(color = coefficient > 0, alpha = abs(coefficient) > 0.5)) +
  scale_alpha_manual(values = c("TRUE" = 0.25, "FALSE" = 0)) +
  guides(color = FALSE, alpha = FALSE)

```

Nous pouvons voir que le lien de précédement annoncé : le lien entre le $SO_2$ libre et le $SO_2$ total. Mais nous constatons également que, dans l'ensemble, il la variable de densité et d'alcool sont liées. Les variables de sucre résiduel et $SO_2$ libre sont également liées. 

Ensuite nous avons réalisé le calcul de corrélation uniquement sur les vins rouges, afin de voir s'il y a des liens entre les variables qui seraient spécifiques aux vins rouges.

```{r}
ggcorr(RWine[, -1], geom = "blank", label = TRUE, hjust = 0.75) +
  geom_point(size = 10, aes(color = coefficient > 0, alpha = abs(coefficient) > 0.5)) +
  scale_alpha_manual(values = c("TRUE" = 0.25, "FALSE" = 0)) +
  guides(color = FALSE, alpha = FALSE)

```

Dans le cas du vin rouge, nous pouvons voir qu'il y a un lien entre le la teneur d'acide citrique et le pH du vin. Nous constatons également que l'acidité volatile et l'acide citrique sont liées.

Le troisième et dernier calcul de corrélation s'est effectué sur les vins blancs. Comme pour le précédent calcul, nous avons réalisé se calcul afin de connaître l'existence de liens entre les variables qui seraient spécifiques aux vins blancs.

```{r}
ggcorr(WWine[, -1], geom = "blank", label = TRUE, hjust = 0.75) +
  geom_point(size = 10, aes(color = coefficient > 0, alpha = abs(coefficient) > 0.5)) +
  scale_alpha_manual(values = c("TRUE" = 0.25, "FALSE" = 0)) +
  guides(color = FALSE, alpha = FALSE)
```

Nous pouvons voir avec ces résultats, nous pouvons voir que la variable de la densité du vin est liée aux variables de sucre résiduel et de $SO_2$ total. 

Nous pouvons observer dans les résultats ci-desssus, qu'il y a des corrélations positives et négatives. Par exemple, la densité et l'alcool ont une corrélation négative : cela signifie que plus il y a d'alcool moins le vin est dense. À l'inverse, le $SO_2$ libre et le $SO_2$ total ont une corrélation positive. Ce qui signifie que plus il y a de $SO_2$ libre plus la teneur totale de $SO_2$ sera importante.

Nous avons choisis de faire le calcul des corrélations afin d'avoir une vision d'ensemble des liens entre les variables. Ainsi nous pouvons faire un plot plus lisible des données pour mieux apprécier les liens.
Ainsi nous avons pu établir le diagramme suivant :

```{r}
plot(AWine[1:100,c(1,2,3,6,7,8,9)])
```

Sur le diagramme ci-dessus, nous pouvons voir qu'il existe un lien entre le pH du vin et son acidité fixe. Ce lien s'explique par le fait que la mesure du pH permet de mesurer l'acidité ou la basicité d'une solution. 
Nous pouvons constater qu'il y a un lien entre le pH et la teneur en acide volatide, et entre le pH et la teneur en acide citrique. 

```{r}
AWine$type<-NULL

arr = c()
for (i in 1:15) {
  res <- kmeans(all_wine,i)
  arr<-c(arr,res$tot.withinss/res$totss)
}

plot(arr)

kmeans(all_wine, 3)
```


## 4 Classification supervisée

Tous les vins
```{r}
SAWine5050<-c(
  sample(
    1:max(which(AWine5050$quality<5)), round(0.8 * max(which(AWine5050$quality<5)), digits=0)
  ),
  sample(
    max(which(AWine5050$quality<5))+1:dim(AWine5050)[1], round(0.8*length(which(AWine5050$quality>=5)), digits = 0)
  )
)
fit<-rpart(AWine5050$quality~ ., data = AWine5050, subset = SAWine5050)
plot(fit)
text(fit)

```

Vins rouges
```{r}
SRWine<-c(
  sample(
    1:max(which(RWine$quality<5)), round(0.8 * max(which(RWine$quality<5)), digits=0)
  ),
  sample(
    max(which(RWine$quality<5))+1:dim(RWine)[1], round(0.8*length(which(RWine$quality>=5)), digits = 0)
  )
)
fit<-rpart(RWine$quality~ ., data = RWine, subset = SRWine)
plot(fit)
text(fit)

```

Vins blancs
```{r}
SWWine<-c(
  sample(
    1:max(which(WWine$quality<5)),round(0.8 * max(which(WWine$quality<5)), digits=0)
  ),
  sample(
    max(which(WWine$quality<5))+1:dim(WWine)[1], round(0.8*length(which(WWine$quality>=5)), digits = 0)
  )
)
fit<-rpart(WWine$quality~ ., data = WWine, subset = SWWine)
plot(fit)
text(fit)
```